<!DOCTYPE html>
<html>
  <head>
    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
      name="viewport"
    />
    <meta charset="utf-8" />
    <title>EROS NOW</title>
    <script type="text/javascript" src="dynamicUIJSON.json"></script>
    <script src="en-web-sdk.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <link href="en-web-sdk.css" rel="stylesheet" />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        background-color: #f1f1f1;
        font-family: arial;
        margin: 0;
      }

      .text-center {
        text-align: center;
      }

      #sdkForm {
        /* background-color: #ffffff; */
        background-color: #f2f2f2;
        margin: 40px auto;
        padding: 40px;
        width: 100%;
        max-width: 560px;
      }

      h1 {
        text-align: center;
      }

      input,
      select {
        padding: 10px;
        width: 100%;
        font-size: 17px;
        border: 1px solid #aaaaaa;
      }

      /* Mark input boxes that gets an error on validation: */
      input.invalid,
      select.invalid {
        background-color: #ffdddd;
      }

      /* Hide all steps by default: */
      .tab {
        display: none;
      }

      .standard-button {
        background-color: #04aa6d;
        color: #ffffff;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        margin: 0 10px 10px 0;
      }

      .standard-button:hover {
        opacity: 0.8;
      }

      /* Make circles that indicate the steps of the form: */
      .step-wrap {
        width: 100%;
        max-width: 560px;
        margin: 40px auto;
      }

      .step-wrap::after {
        content: "";
        border-bottom: 1px solid #ccc;
        padding-bottom: 20px;
        width: 60%;
        position: relative;
        display: inline-block;
        top: -31px;
        z-index: -1;
      }

      .step {
        display: inline-block;
        width: 30%;
      }

      .step-label {
        margin-bottom: 10px;
        color: #aaa;
      }

      .step .circle {
        height: 15px;
        width: 15px;
        margin: 0 2px;
        background-color: #ccc;
        border: none;
        border-radius: 50%;
        display: inline-block;
      }

      .step.active .circle {
        background-color: #aaa;
      }

      .step.active .step-label {
        color: #aaa;
      }

      /* Mark the steps that are finished and valid: */
      .step.finish .circle {
        background-color: #04aa6d;
      }

      .step.finish .step-label {
        color: #04aa6d;
      }

      .resp-field {
        width: 100%;
        max-width: 560px;
        margin: 40px auto;
        display: none;
        height: 320px;
      }

      .loading {
        opacity: 0.5;
        position: relative;
        pointer-events: none;
      }

      .loading::after {
        content: "";
        display: inline-block;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        border: 6px solid #04aa6d24;
        border-top-color: #04aa6d;
        animation: spin 1s infinite linear;
        z-index: 12222;
        position: absolute;
        top: 50%;
        left: 50%;
        margin-top: -20px;
        margin-left: -20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <!-- nextPrev('login');nextPrev('startPlayback'); -->
  <body onload=" nextPrev('init');">
    <div id="main">
      <div id="erosPlayer"></div>
    </div>
    <div class="container">
      <!-- <div class="row text-center">
      <h1>Eros Now Web SDK Sample App</h1>
    </div> -->
      <div class="step-wrap text-center">
        <div class="step" id="init-step">
          <div class="step-label">Initialize SDK</div>
          <span class="circle"></span>
        </div>
        <div class="step" id="login-step">
          <div class="step-label">Do Login</div>
          <span class="circle"></span>
        </div>
        <div class="step" id="playback-step">
          <div class="step-label">Start Playback</div>
          <span class="circle"></span>
        </div>
      </div>
      <form id="sdkForm" action="/action_page.php">
        <div class="tab" id="init" style="opacity: 0">
          <h3>Initialize SDK</h3>
          <p>
            <select id="env" name="env">
              <option value="PRODUCTION">Production</option>
              <option value="STAGING">Staging</option>
              <option value="PRODUCTION">Production</option>
            </select>
          </p>
          <p>
            <input
              placeholder="Partner Code"
              id="partnerCode"
              value="qoe"
              oninput="this.className = ''"
              name="partnerCode"
            />
          </p>
          <p>
            <input
              placeholder="Device Id"
              id="deviceId"
              value=""
              oninput="this.className = ''"
              name="deviceId"
            />
          </p>
          <p>
            <input
              placeholder="Country Code"
              id="country"
              value="IN"
              oninput="this.className = ''"
              name="country"
            />
          </p>
          <div>
            <button
              type="button"
              class="standard-button"
              id="nextBtn"
              onclick="nextPrev('init')"
            >
              Inititalise SDK
            </button>
          </div>
        </div>
        <div class="tab" id="login" style="opacity: 0">
          <h3>Do Login</h3>
          <p>
            <input
              placeholder="Partner User Id"
              id="partnerId"
              value=""
              oninput="this.className = ''"
              name="partnerId"
            />
          </p>
          <p>
            <input
              placeholder="Partner User Token"
              id="partnerUserToken"
              value=""
              oninput="this.className = ''"
              name="partnerUserToken"
            />
          </p>
          <div>
            <button
              type="button"
              class="standard-button"
              id="nextBtn"
              onclick="nextPrev('login')"
            >
              doLogin
            </button>
          </div>
        </div>
        <div class="tab" id="playback" style="opacity: 0">
          <h3>Start Playback</h3>
          <div>
            <p>
              <input
                placeholder="Content ID/Asset ID"
                id="contentInput"
                oninput="this.className = ''"
                name="uname"
                value=""
              />
            </p>
            <button
              type="button"
              class="standard-button"
              id="nextBtn1"
              onclick="nextPrev('startPlayback')"
            >
              Start Playback
            </button>
            <button
              type="button"
              class="standard-button"
              id="nextBtn"
              onclick="nextPrev('fetchContentProfile')"
            >
              Get Content Profile
            </button>
            <button
              type="button"
              class="standard-button"
              id="nextBtn"
              onclick="nextPrev('fetchProgressData')"
            >
              Get Contents Progress
            </button>
            <!-- <p id="playback-error"></p> -->
          </div>
        </div>
      </form>

      <div class="row text-center">
        <p id="playback-error"></p>
      </div>
      <textarea class="resp-field" id="resp-field"></textarea>
    </div>
    <script>
      var sdkInstance;
      var tabs = ["init", "login", "playback"];
      var currentTab = "init";
      showTab(currentTab);

      function showTab(n) {
        var x = document.getElementById(n);
        x.style.display = "block";
        fixStepIndicator(n);
      }

      function nextPrev(n) {
        document.getElementById("contentInput").value =
          localStorage.getItem("erosAssetId");
        document.getElementById("deviceId").value =
          localStorage.getItem("deviceid");
        document.getElementById("partnerId").value =
          localStorage.getItem("partneruniqueid");
        document.getElementById("partnerUserToken").value =
          localStorage.getItem("authToken");
        console.log(
          "partnerUserToken --id,",
          document.getElementById("partnerUserToken").value
        );
        var respField = document.getElementById("resp-field");
        respField.style.display = "none";
        var sdkForm = document.getElementById("sdkForm");
        if (n !== "fetchProgressData" && !validateForm(n)) return false;
        switch (n) {
          case "init":
            var partnerCode = document.getElementById("partnerCode").value;
            var deviceId = document.getElementById("deviceId").value;
            var country = document.getElementById("country").value;
            var env = document.getElementById("env").value;
            // Initialize SDK here
            var config = {
              partnerCode: partnerCode,
              deviceId: deviceId,
              country: country,
              env: env,
            };
            /**
             * Function to intialize the qoe instance
             * @param config object having partnerCode, apiClientId, deviceId, country, env
             */
            sdkInstance = new WebSDK(config);
            console.log("web sdk instance: ", sdkInstance);
            switchTab(n);
            var partnerId = document.getElementById("partnerId").value;
            var partnerUserToken =
              document.getElementById("partnerUserToken").value;
            // Initialize Do Login Here
            /**
             * Function to login the user for qoe
             * @param partnerUserToken partner token
             * @param partnerId partner Id
             */
            sdkForm.classList.add("loading");
            sdkInstance
              .doLogin(partnerUserToken, partnerId)
              .then((res) => {
                console.log("logged in: ", res);
                authtoken = res.data.auth_token;
                sdkForm.classList.remove("loading");
                switchTab("login");
              })
              .catch((err) => {
                sdkForm.classList.remove("loading");
                console.log("login error: ", err);
              });
            break;
          case "login":
            var partnerId = document.getElementById("partnerId").value;
            var partnerUserToken =
              document.getElementById("partnerUserToken").value;
            // Initialize Do Login Here
            /**
             * Function to login the user for qoe
             * @param partnerUserToken partner token
             * @param partnerId partner Id
             */
            sdkForm.classList.add("loading");
            sdkInstance
              .doLogin(partnerUserToken, partnerId)
              .then((res) => {
                console.log("logged in: ", res);
                authtoken = res.data.auth_token;
                sdkForm.classList.remove("loading");
                switchTab(n);
              })
              .catch((err) => {
                sdkForm.classList.remove("loading");
                console.log("login error: ", err);
              });
            break;
          case "startPlayback":
            // Start Video playback here
            var contentId = document.getElementById("contentInput").value;
            sdkForm.classList.add("loading");
            sdkInstance
              .playContent("erosPlayer", contentId)
              .then((res) => {
                sdkForm.classList.remove("loading");
                console.log("play content: ", res);
              })
              .catch((err) => {
                sdkForm.classList.remove("loading");
                document.getElementById("playback-error").innerHTML = err;
                console.log("play content error: ", err);
              });
            break;
          case "fetchContentProfile":
            var contentId = document.getElementById("contentInput").value;
            // Start Video playback here
            /**
             * Function to fetch content
             * @param contentId content id
             * @param authToken token from login api
             */
            sdkForm.classList.add("loading");
            sdkInstance
              .fetchContentProfile(contentId, authtoken)
              .then((res) => {
                console.log("fetch content: ", res);
                respField.style.display = "block";
                respField.value = JSON.stringify(res, null, 2);
                sdkForm.classList.remove("loading");
              })
              .catch((err) => {
                console.log("fetch content error: ", err);
                respField.style.display = "block";
                respField.value = JSON.stringify(err);
                sdkForm.classList.remove("loading");
              });
            break;
          case "fetchProgressData":
            // Start Video playback here
            var contentId = document.getElementById("contentInput").value;
            /**
             * Function to get asset content progress
             * @param assetId asset Id to get progress array
             */
            sdkForm.classList.add("loading");
            sdkInstance
              .fetchProgressData(contentId)
              .then((res) => {
                console.log("asset content progress: ", res);
                respField.style.display = "block";
                respField.value = JSON.stringify(res, null, 2);
                sdkForm.classList.remove("loading");
              })
              .catch((err) => {
                console.log("asset content progress error: ", err);
                respField.style.display = "block";
                respField.value = JSON.stringify(err);
                sdkForm.classList.remove("loading");
              });
            break;
          default:
            break;
        }
      }

      function switchTab(n) {
        var x = document.getElementById(n);
        x.style.display = "none";
        currentTab = tabs[tabs.indexOf(currentTab) + 1];
        showTab(currentTab);
      }

      function validateForm(tab) {
        var x,
          y,
          i,
          valid = true;
        x = document.getElementById(currentTab);
        y = document.getElementsByTagName("input");
        var selectBox = document.getElementsByTagName("select")[0];
        if (selectBox && selectBox.value == "") {
          valid = false;
          selectBox.className += " invalid";
        }
        for (i = 0; i < y.length; i++) {
          if (y[i].value == "") {
            y[i].className += " invalid";
            valid = false;
          }
        }
        if (valid) {
          if (tab == "startPlayback") {
            document.getElementById("playback" + "-step").className +=
              " finish";
          } else {
            document.getElementById(currentTab + "-step").className +=
              " finish";
          }
        }
        return valid;
      }

      function fixStepIndicator(n) {
        var i,
          x = document.getElementsByClassName("step");
        for (i = 0; i < x.length; i++) {
          x[i].className = x[i].className.replace(" active", "");
        }
        document.getElementById(currentTab + "-step").className += " active";
      }

      //  nextPrev('init'); nextPrev('login');nextPrev('startPlayback');
    </script>

    <script>
      var auto_refresh = setTimeout(function () {
        //  nextPrev('init');
        nextPrev("login");
        nextPrev("startPlayback");
      }, 2000);
    </script>
  </body>
</html>
